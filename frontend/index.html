<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zap An√¥nimo - Envie Mensagens pelo WhatsApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(to bottom, #f0f4f8 0%, #ffffff 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .navbar {
            max-width: 700px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }
        }

        .navbar h1 {
            color: #1a1a1a;
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .whatsapp-icon {
            width: 32px;
            height: 32px;
            background: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .whatsapp-icon svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        @media (max-width: 768px) {
            .navbar h1 {
                font-size: 20px;
            }
        }

        .navbar-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .navbar-buttons {
                width: 100%;
                flex-direction: column;
                gap: 8px;
            }
        }

        .user-email {
            color: #1a1a1a;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .user-email {
                max-width: 100%;
                width: 100%;
                text-align: center;
                font-size: 13px;
                order: 3;
                background: #f8fafc;
                padding: 8px;
                border-radius: 6px;
            }

            .credits-badge {
                order: 1;
                flex: 1;
                text-align: center;
            }

            .btn-nav {
                order: 2;
                flex: 1;
                width: 100%;
            }
        }

        .btn-nav {
            padding: 10px 24px;
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-nav:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }

        .credits-badge {
            background: #eef2ff;
            color: #4f46e5;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
        }

        .channel-btn {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .channel-btn:hover {
            border-color: #4f46e5;
        }

        .channel-btn.active {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        h2 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .password-wrapper {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            width: 20px;
            height: 20px;
            user-select: none;
            color: #666;
            transition: color 0.3s;
        }

        .toggle-password:hover {
            color: #25D366;
        }

        .toggle-password svg {
            width: 100%;
            height: 100%;
            fill: currentColor;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="password"],
        input.password-input {
            padding-right: 45px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #25D366;
        }

        textarea {
            resize: vertical;
            min-height: 180px;
            font-family: Arial, sans-serif;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background-color: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .btn:disabled {
            background-color: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-size: 17px;
            padding: 18px;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #5e3a7f 100%);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 5px;
            text-align: center;
            display: none;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .info-box {
            background: #eef2ff;
            border-left: 4px solid #4f46e5;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .info-box p {
            margin: 5px 0;
            color: #475569;
            font-size: 14px;
        }

        .info-box strong {
            color: #4f46e5;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 40px;
            border-radius: 10px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            color: #666;
            font-weight: bold;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
        }

        .form-content {
            display: none;
        }

        .form-content.active {
            display: block;
        }

        .quantity-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .quantity-selector {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .quantity-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quantity-option:hover {
            border-color: #4f46e5;
        }

        .quantity-option.selected {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }

        .quantity-option .amount {
            font-size: 18px;
            font-weight: bold;
            color: #4f46e5;
            line-height: 1.3;
        }

        .quantity-option .price {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item .date {
            font-size: 12px;
            color: #999;
        }

        .history-item .details {
            margin-top: 5px;
            color: #333;
        }

        .history-item.reply-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid #4f46e5;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .welcome-message {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .welcome-message h2 {
            color: white;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .welcome-message p {
            font-size: 16px;
            opacity: 0.9;
        }

        .hidden {
            display: none !important;
        }

        /* Estilos para controles de √°udio */
        .audio-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .audio-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-audio {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            padding: 0;
            background: #25D366;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(37, 211, 102, 0.3);
        }

        .btn-audio svg {
            width: 24px;
            height: 24px;
            fill: #000;
        }

        .btn-audio:hover {
            background: #20bd5a;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
        }

        .btn-audio.recording {
            background: #ef4444;
            animation: pulse-recording 1.5s infinite;
        }

        .btn-audio.recording svg {
            fill: #fff;
        }

        @keyframes pulse-recording {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }

        .btn-upload {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #86efac;
            color: #166534;
        }

        .btn-upload:hover {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-color: #4ade80;
        }

        .audio-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #7dd3fc;
            border-radius: 10px;
        }

        .audio-preview audio {
            flex: 1;
            height: 40px;
        }

        .btn-remove-audio {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #ef4444;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-remove-audio:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .recording-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #fca5a5;
            border-radius: 10px;
            color: #dc2626;
            font-weight: 600;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Player de √°udio nas respostas */
        .reply-audio-player {
            margin-top: 10px;
            padding: 10px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
        }

        .reply-audio-player audio {
            width: 100%;
            height: 36px;
        }

        .audio-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #dbeafe;
            color: #1d4ed8;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        /* Estilos para emoji picker */
        .message-input-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message-input-container textarea {
            width: 100%;
        }

        .emoji-toggle-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 13px;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .emoji-toggle-btn:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-color: #cbd5e1;
        }

        .emoji-toggle-btn .emoji-icon {
            font-size: 18px;
        }

        .emoji-bar {
            display: none;
            flex-wrap: wrap;
            gap: 4px;
            padding: 12px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-top: 8px;
        }

        .emoji-bar.show {
            display: flex;
        }

        .emoji-bar span {
            font-size: 22px;
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.15s ease;
        }

        .emoji-bar span:hover {
            background: #e2e8f0;
            transform: scale(1.2);
        }

        @media (max-width: 768px) {
            .emoji-bar span {
                font-size: 20px;
                padding: 5px 6px;
            }
        }

        /* Melhorias Mobile */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .card {
                padding: 20px 15px;
                border-radius: 12px;
            }

            h2 {
                font-size: 18px;
            }

            .subtitle {
                font-size: 13px;
            }

            label {
                font-size: 13px;
            }

            input, textarea {
                font-size: 16px;
                padding: 14px 12px;
            }

            textarea {
                min-height: 150px;
            }

            .btn {
                padding: 14px;
                font-size: 15px;
            }

            .btn-audio {
                width: 48px;
                height: 48px;
            }

            .btn-audio svg {
                width: 22px;
                height: 22px;
            }

            .emoji-toggle-btn {
                padding: 10px 16px;
                font-size: 14px;
            }

            .form-group {
                margin-bottom: 16px;
            }

            .hint {
                font-size: 11px;
            }

            .audio-controls {
                gap: 10px;
            }

            .recording-indicator {
                padding: 10px 12px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .navbar {
                padding: 12px;
                margin-bottom: 15px;
            }

            .navbar h1 {
                font-size: 18px;
            }

            .card {
                padding: 16px 12px;
            }

            h2 {
                font-size: 16px;
            }

            .quantity-selector {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .quantity-option {
                padding: 12px 8px;
            }

            .quantity-option .quantity {
                font-size: 18px;
            }

            .btn-small {
                padding: 10px 16px;
                font-size: 13px;
            }
        }

        /* Favoritos */
        .favorites-container {
            margin-top: 10px;
        }

        .favorites-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-favorites {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid #f59e0b;
            border-radius: 20px;
            font-size: 13px;
            color: #92400e;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-favorites:hover {
            background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
            transform: scale(1.02);
        }

        .favorites-select {
            flex: 1;
            min-width: 150px;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .favorites-select:focus {
            outline: none;
            border-color: #f59e0b;
        }

        /* Modal Favoritos */
        .favorites-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .favorites-modal.show {
            display: flex;
        }

        .favorites-modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 450px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .favorites-modal-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .favorites-modal-header h3 {
            margin: 0;
            font-size: 18px;
            color: #1e293b;
        }

        .favorites-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 0;
            line-height: 1;
        }

        .favorites-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .favorites-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .favorite-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .favorite-item-info {
            flex: 1;
        }

        .favorite-item-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
        }

        .favorite-item-phone {
            color: #64748b;
            font-size: 13px;
        }

        .favorite-item-actions {
            display: flex;
            gap: 6px;
        }

        .favorite-item-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .favorite-item-btn.use {
            background: #25D366;
            color: white;
        }

        .favorite-item-btn.delete {
            background: #ef4444;
            color: white;
        }

        .favorite-item-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .favorites-empty {
            text-align: center;
            padding: 30px;
            color: #64748b;
        }

        .favorites-add-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .favorites-add-form h4 {
            margin: 0 0 15px 0;
            font-size: 14px;
            color: #1e293b;
        }

        .favorites-add-form input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .favorites-add-form input:focus {
            outline: none;
            border-color: #f59e0b;
        }

        .favorites-add-form button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .favorites-add-form button:hover {
            opacity: 0.9;
        }

        /* Prompt salvar favorito */
        .save-favorite-prompt {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 30px rgba(0,0,0,0.2);
            z-index: 9999;
            max-width: 350px;
            width: calc(100% - 40px);
        }

        .save-favorite-prompt.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .save-favorite-prompt p {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: #1e293b;
        }

        .save-favorite-prompt-buttons {
            display: flex;
            gap: 10px;
        }

        .save-favorite-prompt-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .save-favorite-prompt-buttons .btn-save {
            background: #f59e0b;
            color: white;
        }

        .save-favorite-prompt-buttons .btn-skip {
            background: #e2e8f0;
            color: #64748b;
        }

        /* Modal de Confirmacao/Alerta Personalizado */
        .custom-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99999;
            justify-content: center;
            align-items: center;
        }

        .custom-modal-overlay.show {
            display: flex;
            animation: fadeInOverlay 0.2s ease;
        }

        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .custom-modal-box {
            background: white;
            padding: 28px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
            max-width: 380px;
            width: calc(100% - 40px);
            text-align: center;
            animation: scaleIn 0.2s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .custom-modal-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .custom-modal-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .custom-modal-message {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .custom-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .custom-modal-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-modal-btn:hover {
            transform: translateY(-1px);
        }

        .custom-modal-btn.primary {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
        }

        .custom-modal-btn.primary:hover {
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .custom-modal-btn.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .custom-modal-btn.danger:hover {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .custom-modal-btn.secondary {
            background: #f1f5f9;
            color: #64748b;
        }

        .custom-modal-btn.secondary:hover {
            background: #e2e8f0;
        }

        .custom-modal-btn.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .custom-modal-btn.success:hover {
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        /* Modal PIX */
        .pix-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 99999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .pix-modal.show {
            display: flex;
        }

        .pix-modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .pix-modal-title {
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .pix-modal-subtitle {
            color: #64748b;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .pix-qr-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .pix-qr-container img {
            max-width: 200px;
            border-radius: 8px;
        }

        .pix-code-container {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            word-break: break-all;
            font-family: monospace;
            font-size: 11px;
            color: #475569;
            max-height: 80px;
            overflow-y: auto;
        }

        .pix-copy-btn {
            background: linear-gradient(135deg, #00b4ab 0%, #00968f 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .pix-copy-btn:hover {
            opacity: 0.9;
        }

        .pix-status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 14px;
        }

        .pix-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .pix-status.approved {
            background: #d1fae5;
            color: #065f46;
        }

        .pix-close-btn {
            background: #e2e8f0;
            color: #64748b;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .favorites-row {
                flex-direction: column;
                align-items: stretch;
            }

            .favorites-select {
                width: 100%;
            }

            .favorites-modal-content {
                max-height: 90vh;
            }

            .favorite-item {
                flex-wrap: wrap;
            }

            .favorite-item-actions {
                width: 100%;
                margin-top: 8px;
            }

            .favorite-item-btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>
            <div class="whatsapp-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                </svg>
            </div>
            Zap An√¥nimo
        </h1>
        <div class="navbar-buttons" id="navbar-buttons">
            <button class="btn-nav" onclick="openLoginModal()">Entrar / Cadastrar</button>
        </div>
    </div>


    <div class="main-container" id="welcome-section">
        <div class="card full-width" style="text-align: center; max-width: 700px; margin: 0 auto;">

            <div style="margin-bottom: 40px;">
                <h2 style="font-size: 42px; color: #1e293b; font-weight: 700; margin-bottom: 15px; line-height: 1.2;">
                    Mensagens An√¥nimas<br>no WhatsApp
                </h2>
                <p style="font-size: 20px; color: #64748b; font-weight: 400; margin-top: 15px;">
                    Envie mensagens sem revelar sua identidade
                </p>
            </div>

            <div style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); padding: 40px; border-radius: 16px; margin: 40px 0; color: white; box-shadow: 0 10px 40px rgba(79, 70, 229, 0.2);">

                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">üì± WhatsApp</div>
                    <div style="font-size: 48px; font-weight: 700;">R$ 1,00</div>
                    <div style="font-size: 16px; opacity: 0.85;">por mensagem</div>
                </div>


                <div style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);">
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 15px; opacity: 0.95;">üî• GANHE EM DOBRO! üî•</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 14px;">
                        <div style="text-align: left;">
                            <strong>Pague 5</strong>
                            <div style="font-size: 13px; opacity: 0.9; margin-top: 3px;">Receba <span style="color: #4ade80; font-weight: 600;">10 msgs</span></div>
                        </div>
                        <div style="text-align: left;">
                            <strong>Pague 25</strong>
                            <div style="font-size: 13px; opacity: 0.9; margin-top: 3px;">Receba <span style="color: #4ade80; font-weight: 600;">50 msgs</span></div>
                        </div>
                        <div style="text-align: left;">
                            <strong>Pague 50</strong>
                            <div style="font-size: 13px; opacity: 0.9; margin-top: 3px;">Receba <span style="color: #4ade80; font-weight: 600;">100 msgs</span></div>
                        </div>
                        <div style="text-align: left;">
                            <strong>Pague 100</strong>
                            <div style="font-size: 13px; opacity: 0.9; margin-top: 3px;">Receba <span style="color: #4ade80; font-weight: 600;">200 msgs</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align: left; margin: 40px 0; background: #ffffff; border: 1px solid #e2e8f0; padding: 30px; border-radius: 12px;">
                <div style="display: flex; align-items: start; gap: 15px; margin-bottom: 20px;">
                    <div style="background: #4f46e5; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 18px; font-weight: 600;">1</div>
                    <div>
                        <h3 style="color: #1e293b; font-size: 16px; margin-bottom: 5px; font-weight: 600;">Informe o destinat√°rio</h3>
                        <p style="color: #64748b; font-size: 14px; margin: 0;">Digite o n√∫mero de WhatsApp para quem deseja enviar</p>
                    </div>
                </div>
                <div style="display: flex; align-items: start; gap: 15px; margin-bottom: 20px;">
                    <div style="background: #4f46e5; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 18px; font-weight: 600;">2</div>
                    <div>
                        <h3 style="color: #1e293b; font-size: 16px; margin-bottom: 5px; font-weight: 600;">Escreva sua mensagem</h3>
                        <p style="color: #64748b; font-size: 14px; margin: 0;">Crie o texto que ser√° enviado de forma an√¥nima</p>
                    </div>
                </div>
                <div style="display: flex; align-items: start; gap: 15px;">
                    <div style="background: #4f46e5; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 18px; font-weight: 600;">3</div>
                    <div>
                        <h3 style="color: #1e293b; font-size: 16px; margin-bottom: 5px; font-weight: 600;">Envie com seguran√ßa</h3>
                        <p style="color: #64748b; font-size: 14px; margin: 0;">Sua mensagem √© entregue instantaneamente e de forma totalmente an√¥nima</p>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="openLoginModal()" style="font-size: 18px; padding: 18px; margin-top: 20px;">
                Come√ßar Agora
            </button>
            <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; color: white;">
                <p style="font-size: 18px; font-weight: 600; margin: 0 0 10px 0;">
                    üéÅ B√¥nus de Boas-Vindas
                </p>
                <p style="font-size: 15px; margin: 0; opacity: 0.95;">
                    Cadastre-se e ganhe:<br>
                    üì± <strong>5 mensagens WhatsApp gr√°tis!</strong>
                </p>
            </div>
        </div>
    </div>


    <div class="main-container hidden" id="main-section">

        <div class="card">
            <h2>Enviar Mensagem</h2>
            <p class="subtitle">Envie mensagens de forma an√¥nima e instant√¢nea</p>

            <div class="info-box">
                <p><strong>Custo:</strong> R$ 1,00 por mensagem</p>
                <p><strong>Saldo:</strong> üì± <span id="credits-send-whatsapp">0</span> mensagens</p>
            </div>

            <form id="sendForm" onsubmit="handleSend(event)">
                <div class="form-group">
                    <label for="phone">N√∫mero de Telefone</label>
                    <div style="display: flex; gap: 10px;">
                        <input
                            type="text"
                            value="+55"
                            readonly
                            style="width: 60px; background: #f0f0f0; color: #666;"
                        >
                        <input
                            type="tel"
                            id="phone"
                            placeholder="11999999999"
                            required
                            pattern="[0-9]{10,11}"
                            maxlength="11"
                            style="flex: 1;"
                        >
                    </div>
                    <div class="favorites-container">
                        <div class="favorites-row">
                            <select id="favorites-select" class="favorites-select" onchange="selectFavorite(this.value)">
                                <option value="">Selecionar favorito...</option>
                            </select>
                            <button type="button" class="btn-favorites" onclick="openFavoritesModal()">
                                <span>‚≠ê</span>
                                <span>Gerenciar</span>
                            </button>
                        </div>
                    </div>
                    <p class="hint">Digite apenas DDD + n√∫mero (ex: 11999999999)</p>
                </div>

                <div class="form-group">
                    <label for="message">Mensagem</label>
                    <div class="message-input-container">
                        <textarea
                            id="message"
                            placeholder="Digite sua mensagem aqui..."
                            maxlength="65536"
                        ></textarea>
                        <button type="button" class="emoji-toggle-btn" onclick="toggleEmojis()">
                            <span class="emoji-icon">üòä</span>
                            <span>Emojis</span>
                        </button>
                        <div id="emoji-bar" class="emoji-bar">
                            <span onclick="addEmoji('üòÄ')">üòÄ</span>
                            <span onclick="addEmoji('üòÇ')">üòÇ</span>
                            <span onclick="addEmoji('üòç')">üòç</span>
                            <span onclick="addEmoji('ü•∞')">ü•∞</span>
                            <span onclick="addEmoji('üòò')">üòò</span>
                            <span onclick="addEmoji('üòé')">üòé</span>
                            <span onclick="addEmoji('ü§î')">ü§î</span>
                            <span onclick="addEmoji('üò¢')">üò¢</span>
                            <span onclick="addEmoji('üò≠')">üò≠</span>
                            <span onclick="addEmoji('üò°')">üò°</span>
                            <span onclick="addEmoji('üëç')">üëç</span>
                            <span onclick="addEmoji('üëé')">üëé</span>
                            <span onclick="addEmoji('üëè')">üëè</span>
                            <span onclick="addEmoji('üôè')">üôè</span>
                            <span onclick="addEmoji('üí™')">üí™</span>
                            <span onclick="addEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
                            <span onclick="addEmoji('üíî')">üíî</span>
                            <span onclick="addEmoji('üî•')">üî•</span>
                            <span onclick="addEmoji('‚ú®')">‚ú®</span>
                            <span onclick="addEmoji('üéâ')">üéâ</span>
                            <span onclick="addEmoji('üíØ')">üíØ</span>
                            <span onclick="addEmoji('ü§£')">ü§£</span>
                            <span onclick="addEmoji('üòÖ')">üòÖ</span>
                            <span onclick="addEmoji('üòä')">üòä</span>
                            <span onclick="addEmoji('üôÑ')">üôÑ</span>
                            <span onclick="addEmoji('üòè')">üòè</span>
                            <span onclick="addEmoji('üò¥')">üò¥</span>
                            <span onclick="addEmoji('ü§ó')">ü§ó</span>
                            <span onclick="addEmoji('ü§´')">ü§´</span>
                            <span onclick="addEmoji('ü§≠')">ü§≠</span>
                        </div>
                    </div>
                    <small style="color: #64748b; font-size: 12px;">M√°ximo: 65.536 caracteres</small>
                </div>

                <!-- Controles de √Åudio -->
                <div class="form-group">
                    <label>Ou grave um √°udio</label>
                    <div class="audio-controls">
                        <div class="audio-buttons">
                            <button type="button" class="btn-audio" id="record-btn" onclick="toggleRecording()" title="Gravar audio">
                                <svg id="mic-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/>
                                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                                </svg>
                                <svg id="stop-icon" style="display:none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="6" y="6" width="12" height="12" rx="2"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Preview do √°udio -->
                        <div id="audio-preview-container" class="audio-preview" style="display: none;">
                            <audio id="audio-preview" controls></audio>
                            <button type="button" class="btn-remove-audio" onclick="removeAudio()">‚úï</button>
                        </div>

                        <!-- Indicador de grava√ß√£o -->
                        <div id="recording-indicator" class="recording-indicator" style="display: none;">
                            <span class="recording-dot"></span>
                            <span id="recording-time">00:00</span>
                        </div>
                    </div>
                    <small style="color: #64748b; font-size: 12px;">Clique em gravar, fale e clique novamente para parar</small>
                </div>

                <button type="submit" class="btn" id="send-btn">Enviar Mensagem</button>
            </form>

            <div id="whatsapp-status-indicator" class="message" style="display: none;"></div>
            <div id="send-message" class="message"></div>
        </div>


        <div class="card">
            <h2>Comprar Mensagens</h2>
            <p class="subtitle">R$ 1,00 por mensagem</p>

            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; font-weight: 600; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
                üî• PROMO√á√ÉO: GANHE EM DOBRO! üî•
            </div>

            <div class="quantity-selector" id="quantity-selector">
                <div class="quantity-option" onclick="selectQuantity(5)">
                    <div class="amount">5 + 5 gr√°tis</div>
                    <div class="price">R$ 5,00 <small style="color: #10b981; font-weight: 600;">= 10 msgs</small></div>
                </div>
                <div class="quantity-option" onclick="selectQuantity(25)">
                    <div class="amount">25 + 25 gr√°tis</div>
                    <div class="price">R$ 25,00 <small style="color: #10b981; font-weight: 600;">= 50 msgs</small></div>
                </div>
                <div class="quantity-option" onclick="selectQuantity(50)">
                    <div class="amount">50 + 50 gr√°tis</div>
                    <div class="price">R$ 50,00 <small style="color: #10b981; font-weight: 600;">= 100 msgs</small></div>
                </div>
                <div class="quantity-option" onclick="selectQuantity(100)">
                    <div class="amount">100 + 100 gr√°tis</div>
                    <div class="price">R$ 100,00 <small style="color: #10b981; font-weight: 600;">= 200 msgs</small></div>
                </div>
            </div>

            <div class="form-group">
                <label for="custom-quantity">Ou digite a quantidade:</label>
                <input
                    type="number"
                    id="custom-quantity"
                    min="1"
                    placeholder="Quantidade de mensagens"
                    oninput="updateBonusPreview()"
                >
                <small id="bonus-preview" style="color: #10b981; font-weight: 600; display: none; margin-top: 8px;"></small>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn" onclick="buyWithPix()" id="buy-pix-btn" style="flex: 1; background: linear-gradient(135deg, #00b4ab 0%, #00968f 100%);">
                    <span style="font-size: 18px;">üì±</span> Pagar com PIX
                </button>
                <button class="btn btn-secondary" onclick="buyWithCard()" id="buy-card-btn" style="flex: 1;">
                    <span style="font-size: 18px;">üí≥</span> Cart√£o
                </button>
            </div>

            <div id="buy-message" class="message"></div>

            <!-- Hist√≥rico de Pagamentos -->
            <div style="margin-top: 25px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
                <h3 style="font-size: 16px; color: #374151; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">üìã</span> Hist√≥rico de Pagamentos
                </h3>
                <div id="payment-history" style="max-height: 200px; overflow-y: auto;">
                    <p style="text-align: center; color: #999; font-size: 14px;">Carregando...</p>
                </div>
            </div>
        </div>


        <div class="card">
            <h2>Mensagens Enviadas</h2>
            <p class="subtitle">Hist√≥rico de mensagens que voc√™ enviou</p>
            <div class="history-list" id="history-list">
                <p style="text-align: center; color: #999;">Carregando...</p>
            </div>
        </div>


        <div class="card">
            <h2>Respostas Recebidas</h2>
            <p class="subtitle">Respostas √†s suas mensagens an√¥nimas</p>
            <div class="history-list" id="replies-list">
                <p style="text-align: center; color: #999;">Carregando...</p>
            </div>
        </div>
    </div>


    <div id="forgotPasswordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeForgotPasswordModal()">&times;</span>
            <h2 style="color: #1e293b; margin-bottom: 10px;">Recuperar Senha</h2>
            <p style="color: #64748b; margin-bottom: 30px;">Digite seu email para receber o link de recupera√ß√£o</p>

            <form onsubmit="handleForgotPassword(event)">
                <div class="form-group">
                    <label for="forgot-email">Email</label>
                    <input type="email" id="forgot-email" required>
                </div>

                <button type="submit" class="btn" id="forgot-btn">Enviar Link de Recupera√ß√£o</button>
            </form>

            <div id="forgot-message" class="message"></div>

            <div style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="backToLogin(event)" style="color: #4f46e5; text-decoration: none; font-size: 14px;">Voltar ao Login</a>
            </div>
        </div>
    </div>


    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2 style="color: #1e293b; margin-bottom: 10px;">Bem-vindo</h2>
            <p style="color: #64748b; margin-bottom: 30px;">Fa√ßa login ou crie sua conta</p>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('login')">Login</div>
                <div class="tab" onclick="switchTab('register')">Cadastro</div>
            </div>

            <!-- LOGIN FORM -->
            <div id="login-form" class="form-content active">
                <!-- Toggle Email/Telefone -->
                <div class="auth-type-toggle" style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button type="button" class="auth-toggle-btn active" id="login-email-toggle" onclick="toggleLoginType('email')" style="flex: 1; padding: 10px; border: 2px solid #4f46e5; background: #4f46e5; color: white; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Email
                    </button>
                    <button type="button" class="auth-toggle-btn" id="login-phone-toggle" onclick="toggleLoginType('phone')" style="flex: 1; padding: 10px; border: 2px solid #e2e8f0; background: white; color: #64748b; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Telefone
                    </button>
                </div>

                <form onsubmit="handleLogin(event)">
                    <!-- Campo Email -->
                    <div class="form-group" id="login-email-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email">
                    </div>

                    <!-- Campo Telefone -->
                    <div class="form-group" id="login-phone-group" style="display: none;">
                        <label for="login-phone">Telefone</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" value="+55" readonly style="width: 60px; background: #f0f0f0; color: #666;">
                            <input type="tel" id="login-phone" placeholder="11999999999" pattern="[0-9]{10,11}" maxlength="11" style="flex: 1;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="login-password">Senha</label>
                        <div class="password-wrapper">
                            <input type="password" id="login-password" class="password-input" required>
                            <span class="toggle-password" onclick="togglePassword('login-password')">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </span>
                        </div>
                    </div>

                    <button type="submit" class="btn" id="login-btn">Entrar</button>
                </form>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="openForgotPasswordModal(event)" style="color: #4f46e5; text-decoration: none; font-size: 14px;">Esqueceu sua senha?</a>
                </div>
            </div>

            <!-- REGISTER FORM -->
            <div id="register-form" class="form-content">
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 18px; margin-bottom: 20px; border-radius: 8px; color: white;">
                    <p style="font-size: 15px; margin: 0 0 8px 0; font-weight: 600;">
                        B√¥nus de Boas-Vindas
                    </p>
                    <p style="font-size: 14px; margin: 0; opacity: 0.95;">
                        <strong>5 mensagens WhatsApp gr√°tis!</strong>
                    </p>
                </div>

                <!-- Toggle Email/Telefone -->
                <div class="auth-type-toggle" style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button type="button" class="auth-toggle-btn active" id="register-email-toggle" onclick="toggleRegisterType('email')" style="flex: 1; padding: 10px; border: 2px solid #4f46e5; background: #4f46e5; color: white; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Email
                    </button>
                    <button type="button" class="auth-toggle-btn" id="register-phone-toggle" onclick="toggleRegisterType('phone')" style="flex: 1; padding: 10px; border: 2px solid #e2e8f0; background: white; color: #64748b; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Telefone
                    </button>
                </div>

                <form onsubmit="handleRegister(event)" id="register-form-element">
                    <!-- Campo Email -->
                    <div class="form-group" id="register-email-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email">
                    </div>

                    <!-- Campo Telefone -->
                    <div class="form-group" id="register-phone-group" style="display: none;">
                        <label for="register-phone">Telefone</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" value="+55" readonly style="width: 60px; background: #f0f0f0; color: #666;">
                            <input type="tel" id="register-phone" placeholder="11999999999" pattern="[0-9]{10,11}" maxlength="11" style="flex: 1;">
                        </div>
                        <p class="hint">Digite DDD + n√∫mero (ex: 11999999999)</p>
                    </div>

                    <div class="form-group">
                        <label for="register-password">Senha</label>
                        <div class="password-wrapper">
                            <input type="password" id="register-password" class="password-input" required minlength="6">
                            <span class="toggle-password" onclick="togglePassword('register-password')">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </span>
                        </div>
                        <p class="hint">M√≠nimo 6 caracteres</p>
                    </div>

                    <div class="form-group">
                        <label for="register-password-confirm">Confirmar Senha</label>
                        <div class="password-wrapper">
                            <input type="password" id="register-password-confirm" class="password-input" required>
                            <span class="toggle-password" onclick="togglePassword('register-password-confirm')">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </span>
                        </div>
                    </div>

                    <button type="submit" class="btn" id="register-btn">Criar Conta</button>
                </form>
            </div>

            <!-- VERIFY PHONE CODE FORM -->
            <div id="verify-phone-form" class="form-content" style="display: none;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">üí¨</div>
                    <h3 style="color: #1e293b; margin-bottom: 10px;">Verificar Telefone</h3>
                    <p style="color: #64748b; font-size: 14px;">Digite o c√≥digo de 6 d√≠gitos enviado pelo WhatsApp para</p>
                    <p style="color: #4f46e5; font-weight: 600;" id="verify-phone-display"></p>
                </div>

                <form onsubmit="handleVerifyPhone(event)">
                    <div class="form-group">
                        <label for="verify-code">C√≥digo de Verifica√ß√£o</label>
                        <input type="text" id="verify-code" placeholder="000000" maxlength="6" pattern="[0-9]{6}" style="text-align: center; font-size: 24px; letter-spacing: 8px; font-weight: 600;" required>
                    </div>

                    <button type="submit" class="btn" id="verify-btn">Verificar</button>
                </form>

                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="resendPhoneCode(event)" style="color: #4f46e5; text-decoration: none; font-size: 14px;">Reenviar c√≥digo</a>
                </div>

                <div style="text-align: center; margin-top: 10px;">
                    <a href="#" onclick="backToRegister(event)" style="color: #64748b; text-decoration: none; font-size: 14px;">Voltar</a>
                </div>
            </div>

            <div id="modal-message" class="message"></div>
        </div>
    </div>


    <script src="config.js"></script>
    <script src="api.js"></script>

    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>

    <script>
    
        function formatDateBR(dateString) {
            const date = new Date(dateString);
            date.setHours(date.getHours() - 3);
            return date.toLocaleString('pt-BR');
        }

        let token = localStorage.getItem('token');
        let user = JSON.parse(localStorage.getItem('user') || 'null');
        let selectedQuantity = 0;
        let selectedChannel = 'whatsapp';
        let selectedCreditType = 'whatsapp';
        let repliesPollingInterval = null;
        let socket = null;

      
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let recordingStartTime = null;
        let recordingTimer = null;
        let currentAudioBlob = null;
        let currentAudioBase64 = null;
        let currentAudioMimetype = null;

  
        let currentLoginType = 'email';
        let currentRegisterType = 'email';
        let pendingPhoneVerification = null;

    
        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

              
                const mimeType = MediaRecorder.isTypeSupported('audio/webm;codecs=opus')
                    ? 'audio/webm;codecs=opus'
                    : 'audio/webm';

                mediaRecorder = new MediaRecorder(stream, { mimeType });
                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: mimeType });
                    processAudioBlob(audioBlob, mimeType);

                   
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                isRecording = true;
                recordingStartTime = Date.now();

                
                const recordBtn = document.getElementById('record-btn');
                const micIcon = document.getElementById('mic-icon');
                const stopIcon = document.getElementById('stop-icon');
                const recordingIndicator = document.getElementById('recording-indicator');

                recordBtn.classList.add('recording');
                micIcon.style.display = 'none';
                stopIcon.style.display = 'block';
                recordingIndicator.style.display = 'flex';

             
                updateRecordingTime();
                recordingTimer = setInterval(updateRecordingTime, 1000);

            } catch (error) {
                console.error('Erro ao acessar microfone:', error);
                showMessage('send-message', 'N√£o foi poss√≠vel acessar o microfone. Verifique as permiss√µes.', 'error');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;

               
                if (recordingTimer) {
                    clearInterval(recordingTimer);
                    recordingTimer = null;
                }

               
                const recordBtn = document.getElementById('record-btn');
                const micIcon = document.getElementById('mic-icon');
                const stopIcon = document.getElementById('stop-icon');
                const recordingIndicator = document.getElementById('recording-indicator');

                recordBtn.classList.remove('recording');
                micIcon.style.display = 'block';
                stopIcon.style.display = 'none';
                recordingIndicator.style.display = 'none';
            }
        }

        function updateRecordingTime() {
            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('recording-time').textContent = `${minutes}:${seconds}`;
        }

        function handleAudioUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            
            if (file.size > 16 * 1024 * 1024) {
                showMessage('send-message', 'Arquivo muito grande. M√°ximo: 16MB', 'error');
                event.target.value = '';
                return;
            }

           
            if (!file.type.startsWith('audio/')) {
                showMessage('send-message', 'Por favor, selecione um arquivo de √°udio v√°lido.', 'error');
                event.target.value = '';
                return;
            }

            processAudioBlob(file, file.type);
        }

        function processAudioBlob(blob, mimetype) {
            currentAudioBlob = blob;
            currentAudioMimetype = mimetype;

          
            const reader = new FileReader();
            reader.onloadend = () => {
               
                currentAudioBase64 = reader.result.split(',')[1];

              
                const previewContainer = document.getElementById('audio-preview-container');
                const audioPreview = document.getElementById('audio-preview');

                audioPreview.src = URL.createObjectURL(blob);
                previewContainer.style.display = 'flex';
            };
            reader.readAsDataURL(blob);
        }

        function removeAudio() {
            currentAudioBlob = null;
            currentAudioBase64 = null;
            currentAudioMimetype = null;

            const previewContainer = document.getElementById('audio-preview-container');
            const audioPreview = document.getElementById('audio-preview');

            previewContainer.style.display = 'none';
            audioPreview.src = '';
        }

       
        function toggleEmojis() {
            const emojiBar = document.getElementById('emoji-bar');
            emojiBar.classList.toggle('show');
        }

        function addEmoji(emoji) {
            const textarea = document.getElementById('message');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;

            textarea.value = text.substring(0, start) + emoji + text.substring(end);
            textarea.focus();
            textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
        }

     
        let lastSentPhone = null;
        let favoritesCache = [];

        async function loadFavorites() {
            if (!token) return [];

            try {
                const response = await API.get('/api/favorites', token);
                const data = await response.json();

                if (data.success) {
                    favoritesCache = data.favorites;
                    return data.favorites;
                }
                return [];
            } catch (error) {
                console.error('Erro ao carregar favoritos:', error);
                return [];
            }
        }

        async function updateFavoritesSelect() {
            const select = document.getElementById('favorites-select');
            if (!select) return;

            const favorites = await loadFavorites();
            select.innerHTML = '<option value="">Selecionar favorito...</option>';

            favorites.forEach((fav) => {
                const option = document.createElement('option');
                option.value = fav.id;
                option.textContent = `${fav.name} (${fav.phone})`;
                select.appendChild(option);
            });
        }

        function selectFavorite(id) {
            if (id === '') return;

            const fav = favoritesCache.find(f => f.id == id);

            if (fav) {
                document.getElementById('phone').value = fav.phone;
                document.getElementById('favorites-select').value = '';
            }
        }

        async function openFavoritesModal() {
            await renderFavoritesList();
            document.getElementById('favorites-modal').classList.add('show');
        }

        function closeFavoritesModal() {
            document.getElementById('favorites-modal').classList.remove('show');
            document.getElementById('new-favorite-name').value = '';
            document.getElementById('new-favorite-phone').value = '';
        }

        function closeFavoritesModalOnBackdrop(event) {
            if (event.target.id === 'favorites-modal') {
                closeFavoritesModal();
            }
        }

        async function renderFavoritesList() {
            const container = document.getElementById('favorites-list');
            const favorites = await loadFavorites();

            if (favorites.length === 0) {
                container.innerHTML = '<div class="favorites-empty">Nenhum favorito salvo ainda.</div>';
                return;
            }

            container.innerHTML = favorites.map((fav) => `
                <div class="favorite-item">
                    <div class="favorite-item-info">
                        <div class="favorite-item-name">${fav.name}</div>
                        <div class="favorite-item-phone">+55 ${fav.phone}</div>
                    </div>
                    <div class="favorite-item-actions">
                        <button class="favorite-item-btn use" onclick="useFavorite(${fav.id})">Usar</button>
                        <button class="favorite-item-btn delete" onclick="deleteFavoriteById(${fav.id})">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        async function addFavorite() {
            const nameInput = document.getElementById('new-favorite-name');
            const phoneInput = document.getElementById('new-favorite-phone');

            const name = nameInput.value.trim();
            const phone = phoneInput.value.replace(/\D/g, '');

            if (!name) {
                showAlert('Digite um nome para o favorito', 'warning');
                return;
            }

            if (phone.length < 10 || phone.length > 11) {
                showAlert('Digite um telefone v√°lido (10 ou 11 d√≠gitos)', 'warning');
                return;
            }

            try {
                const response = await API.post('/api/favorites', { name, phone }, token);
                const data = await response.json();

                if (data.success) {
                    nameInput.value = '';
                    phoneInput.value = '';
                    await renderFavoritesList();
                    await updateFavoritesSelect();
                    showAlert('Favorito adicionado com sucesso!', 'success');
                } else {
                    showAlert(data.error || 'Erro ao adicionar favorito', 'error');
                }
            } catch (error) {
                showAlert('Erro ao adicionar favorito: ' + error.message, 'error');
            }
        }

        function useFavorite(id) {
            const fav = favoritesCache.find(f => f.id == id);

            if (fav) {
                document.getElementById('phone').value = fav.phone;
                closeFavoritesModal();
            }
        }

        async function deleteFavoriteById(id) {
            const confirmed = await showConfirm('Tem certeza que deseja excluir este favorito?', 'Excluir Favorito');
            if (!confirmed) return;

            try {
                const response = await API.delete('/api/favorites/' + id, token);
                const data = await response.json();

                if (data.success) {
                    await renderFavoritesList();
                    await updateFavoritesSelect();
                    showAlert('Favorito exclu√≠do com sucesso!', 'success');
                } else {
                    showAlert(data.error || 'Erro ao excluir favorito', 'error');
                }
            } catch (error) {
                showAlert('Erro ao excluir favorito: ' + error.message, 'error');
            }
        }

        async function showSavePrompt(phone) {
            if (!token) return;

         
            try {
                const response = await API.get('/api/favorites/check/' + phone, token);
                const data = await response.json();

                if (data.isFavorite) return;

                lastSentPhone = phone;
                document.getElementById('save-favorite-name').value = '';
                document.getElementById('save-favorite-prompt').classList.add('show');
            } catch (error) {
                console.error('Erro ao verificar favorito:', error);
            }
        }

        function closeSavePrompt() {
            document.getElementById('save-favorite-prompt').classList.remove('show');
            lastSentPhone = null;
        }

        async function saveFavoriteFromPrompt() {
            const nameInput = document.getElementById('save-favorite-name');
            const name = nameInput.value.trim();

            if (!name) {
                showAlert('Digite um nome para o contato', 'warning');
                return;
            }

            if (!lastSentPhone) return;

            try {
                const response = await API.post('/api/favorites', { name, phone: lastSentPhone }, token);
                const data = await response.json();

                if (data.success) {
                    await updateFavoritesSelect();
                    closeSavePrompt();
                    showAlert('Contato salvo nos favoritos!', 'success');
                } else {
                    showAlert(data.error || 'Erro ao salvar favorito', 'error');
                }
            } catch (error) {
                showAlert('Erro ao salvar favorito: ' + error.message, 'error');
            }
        }

   
        let customModalResolve = null;

        function showAlert(message, type = 'info') {
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            const titles = {
                success: 'Sucesso!',
                error: 'Erro',
                warning: 'Aten√ß√£o',
                info: 'Informa√ß√£o'
            };
            const btnClass = type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary';

            document.getElementById('custom-modal-icon').textContent = icons[type] || icons.info;
            document.getElementById('custom-modal-title').textContent = titles[type] || titles.info;
            document.getElementById('custom-modal-message').textContent = message;
            document.getElementById('custom-modal-buttons').innerHTML = `
                <button class="custom-modal-btn ${btnClass}" onclick="closeCustomModal()">OK</button>
            `;
            document.getElementById('custom-modal').classList.add('show');
        }

        function showConfirm(message, title = 'Confirmar') {
            return new Promise((resolve) => {
                customModalResolve = resolve;
                document.getElementById('custom-modal-icon').textContent = '‚ùì';
                document.getElementById('custom-modal-title').textContent = title;
                document.getElementById('custom-modal-message').textContent = message;
                document.getElementById('custom-modal-buttons').innerHTML = `
                    <button class="custom-modal-btn secondary" onclick="resolveCustomModal(false)">Cancelar</button>
                    <button class="custom-modal-btn danger" onclick="resolveCustomModal(true)">Confirmar</button>
                `;
                document.getElementById('custom-modal').classList.add('show');
            });
        }

        function closeCustomModal() {
            document.getElementById('custom-modal').classList.remove('show');
        }

        function resolveCustomModal(value) {
            document.getElementById('custom-modal').classList.remove('show');
            if (customModalResolve) {
                customModalResolve(value);
                customModalResolve = null;
            }
        }

        function closeCustomModalOnBackdrop(event) {
            if (event.target.id === 'custom-modal') {
                closeCustomModal();
                if (customModalResolve) {
                    customModalResolve(false);
                    customModalResolve = null;
                }
            }
        }

        function showSuccessRegistration(email) {
            document.getElementById('custom-modal-icon').textContent = 'üéâ';
            document.getElementById('custom-modal-title').textContent = 'Conta Criada com Sucesso!';
            document.getElementById('custom-modal-message').innerHTML = `
                <div style="text-align: left; line-height: 1.8;">
                    <p style="margin-bottom: 12px;">üìß Um email de verifica√ß√£o foi enviado para:</p>
                    <p style="font-weight: 600; color: #4f46e5; margin-bottom: 16px;">${email}</p>
                    <p style="font-weight: 600; margin-bottom: 8px;">‚ö†Ô∏è IMPORTANTE:</p>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>Verifique sua caixa de entrada (e spam)</li>
                        <li>Clique no link de verifica√ß√£o</li>
                        <li>S√≥ ent√£o voc√™ poder√° fazer login</li>
                    </ul>
                </div>
            `;
            document.getElementById('custom-modal-buttons').innerHTML = `
                <button class="custom-modal-btn success" onclick="closeCustomModal()">Entendi</button>
            `;
            document.getElementById('custom-modal').classList.add('show');
        }
   

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggle = event.currentTarget;

            if (input.type === 'password') {
                input.type = 'text';
                toggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>';
            } else {
                input.type = 'password';
                toggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>';
            }
        }

        function updateUI() {
            const navButtons = document.getElementById('navbar-buttons');
            const welcomeSection = document.getElementById('welcome-section');
            const mainSection = document.getElementById('main-section');

            if (token && user) {
                const userIdentifier = user.email || user.phone || 'Usu√°rio';
                navButtons.innerHTML = `
                    <span class="user-email">${userIdentifier}</span>
                    <button class="btn-nav" onclick="logout()">Sair</button>
                `;
                welcomeSection.classList.add('hidden');
                mainSection.classList.remove('hidden');
                loadUserData();
                loadHistory();
                loadReplies();
                loadPaymentHistory();
                connectSocket();
                startRepliesPolling();
                checkWhatsAppStatus();
                updateFavoritesSelect(); 
            } else {
                navButtons.innerHTML = `
                    <button class="btn-nav" onclick="openLoginModal()">Entrar / Cadastrar</button>
                `;
                welcomeSection.classList.remove('hidden');
                mainSection.classList.add('hidden');
                disconnectSocket(); 
                stopRepliesPolling();
            }
        }

        async function loadUserData() {
            if (!token) return;

            try {
                const response = await API.get('/api/user/profile', token);

                if (response.status === 401) {
                    logout();
                    return;
                }

                const data = await response.json();
                if (data.success) {
                    updateCreditsDisplay(data.user.whatsapp_credits, data.user.sms_credits);
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        function updateCreditsDisplay(whatsappCredits, smsCredits) {
            document.getElementById('credits-send-whatsapp').textContent = whatsappCredits;
        }

        async function checkWhatsAppStatus() {
            const indicator = document.getElementById('whatsapp-status-indicator');
            try {
                const response = await API.get('/api/whatsapp/available', token);
                const data = await response.json();

                if (data.success && data.available) {
                    indicator.style.display = 'none';
                } else {
                    indicator.style.display = 'block';
                    indicator.className = 'message error';
                    indicator.innerHTML = 'Sistema temporariamente offline. Tente novamente em alguns minutos.';
                }
            } catch (error) {
                indicator.style.display = 'block';
                indicator.className = 'message error';
                indicator.innerHTML = 'Erro ao verificar status do WhatsApp';
            }
        }

        function hideWhatsAppStatus() {
            const indicator = document.getElementById('whatsapp-status-indicator');
            indicator.style.display = 'none';
        }

        async function loadHistory() {
            if (!token) return;

            try {
                const response = await API.get('/api/messages', token);

                const data = await response.json();
                const historyList = document.getElementById('history-list');

                if (data.success && data.messages.length > 0) {
                    historyList.innerHTML = data.messages.map(msg => {
                        const hasReply = msg.has_reply ? '<span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px;">Respondida</span>' : '';
                        return `
                            <div class="history-item">
                                <div class="date">${formatDateBR(msg.created_at)}${hasReply}</div>
                                <div class="details">
                                    <strong>Para:</strong> ${msg.phone}<br>
                                    <strong>Mensagem:</strong> ${msg.message}
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    historyList.innerHTML = '<p style="text-align: center; color: #999;">Nenhuma mensagem enviada ainda</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
        }

        async function loadReplies() {
            if (!token) return;

            const repliesList = document.getElementById('replies-list');

            try {
                const response = await API.get('/api/replies', token);

                const data = await response.json();

                if (data.success && data.replies && data.replies.length > 0) {
                    repliesList.innerHTML = data.replies.map(reply => {
                      
                        const hasAudio = reply.audio_url && reply.audio_url.length > 0;
                        const audioPlayer = hasAudio ? `
                            <div class="reply-audio-player">
                                <span class="audio-badge">üé§ Mensagem de √°udio</span>
                                <audio controls src="${reply.audio_url}" preload="metadata"></audio>
                            </div>
                        ` : '';

                        return `
                            <div class="history-item reply-item">
                                <div class="date">
                                    <span style="background: #4f46e5; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-right: 8px;">Nova</span>
                                    ${hasAudio ? '<span class="audio-badge" style="margin-right: 8px;">üé§ √Åudio</span>' : ''}
                                    ${formatDateBR(reply.created_at)}
                                </div>
                                <div class="details">
                                    <strong>De:</strong> ${reply.from_phone}<br>
                                    <strong>Resposta:</strong> ${reply.message}
                                </div>
                                ${audioPlayer}
                                ${reply.original_message ? `<div style="margin-top: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; border-left: 3px solid #cbd5e1;">
                                    <small style="color: #64748b;">Em resposta a:</small><br>
                                    <span style="color: #475569; font-size: 13px;">${reply.original_message}</span>
                                </div>` : ''}
                            </div>
                        `;
                    }).join('');
                } else {
                    repliesList.innerHTML = `
                        <div style="text-align: center; padding: 30px 20px;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                            <p style="color: #64748b; margin: 0;">Nenhuma resposta recebida ainda</p>
                            <p style="color: #94a3b8; font-size: 13px; margin-top: 8px;">Quando algu√©m responder suas mensagens, aparecer√° aqui</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar respostas:', error);
                repliesList.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                        <p style="color: #64748b; margin: 0;">Nenhuma resposta recebida ainda</p>
                        <p style="color: #94a3b8; font-size: 13px; margin-top: 8px;">Quando algu√©m responder suas mensagens, aparecer√° aqui</p>
                    </div>
                `;
            }
        }

        async function loadPaymentHistory() {
            if (!token) return;

            const paymentHistoryEl = document.getElementById('payment-history');

            try {
                const response = await API.get('/api/transactions', token);
                const data = await response.json();

                if (data.success && data.transactions && data.transactions.length > 0) {
                    // Filtrar apenas compras (type = 'purchase')
                    const purchases = data.transactions.filter(t => t.type === 'purchase');

                    if (purchases.length > 0) {
                        paymentHistoryEl.innerHTML = purchases.slice(0, 10).map(purchase => {
                            const date = new Date(purchase.created_at);
                            const formattedDate = date.toLocaleDateString('pt-BR', {
                                day: '2-digit',
                                month: '2-digit',
                                year: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            });

                            const statusColor = '#10b981';
                            const statusIcon = '‚úì';

                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; font-size: 13px;">
                                    <div>
                                        <div style="color: #374151; font-weight: 500;">
                                            <span style="color: ${statusColor}; margin-right: 5px;">${statusIcon}</span>
                                            +${purchase.credits_added} cr√©ditos
                                        </div>
                                        <div style="color: #9ca3af; font-size: 11px; margin-top: 2px;">${formattedDate}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #374151; font-weight: 600;">R$ ${purchase.price ? purchase.price.toFixed(2).replace('.', ',') : '0,00'}</div>
                                        <div style="color: ${statusColor}; font-size: 11px;">Aprovado</div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    } else {
                        paymentHistoryEl.innerHTML = `
                            <p style="text-align: center; color: #9ca3af; font-size: 13px; padding: 15px 0;">
                                Nenhuma compra realizada ainda
                            </p>
                        `;
                    }
                } else {
                    paymentHistoryEl.innerHTML = `
                        <p style="text-align: center; color: #9ca3af; font-size: 13px; padding: 15px 0;">
                            Nenhuma compra realizada ainda
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico de pagamentos:', error);
                paymentHistoryEl.innerHTML = `
                    <p style="text-align: center; color: #9ca3af; font-size: 13px; padding: 15px 0;">
                        Nenhuma compra realizada ainda
                    </p>
                `;
            }
        }

        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function openForgotPasswordModal(event) {
            event.preventDefault();
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('forgotPasswordModal').style.display = 'block';
        }

        function closeForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').style.display = 'none';
        }

        function backToLogin(event) {
            event.preventDefault();
            document.getElementById('forgotPasswordModal').style.display = 'none';
            document.getElementById('loginModal').style.display = 'block';
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-content').forEach(f => f.classList.remove('active'));

            if (tab === 'login') {
                document.querySelector('.tab:first-child').classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.querySelector('.tab:last-child').classList.add('active');
                document.getElementById('register-form').classList.add('active');
            }

            document.getElementById('modal-message').style.display = 'none';
        }

  
        function toggleLoginType(type) {
            currentLoginType = type;
            const emailToggle = document.getElementById('login-email-toggle');
            const phoneToggle = document.getElementById('login-phone-toggle');
            const emailGroup = document.getElementById('login-email-group');
            const phoneGroup = document.getElementById('login-phone-group');

            if (type === 'email') {
                emailToggle.style.background = '#4f46e5';
                emailToggle.style.color = 'white';
                emailToggle.style.borderColor = '#4f46e5';
                phoneToggle.style.background = 'white';
                phoneToggle.style.color = '#64748b';
                phoneToggle.style.borderColor = '#e2e8f0';
                emailGroup.style.display = 'block';
                phoneGroup.style.display = 'none';
                document.getElementById('login-email').required = true;
                document.getElementById('login-phone').required = false;
            } else {
                phoneToggle.style.background = '#4f46e5';
                phoneToggle.style.color = 'white';
                phoneToggle.style.borderColor = '#4f46e5';
                emailToggle.style.background = 'white';
                emailToggle.style.color = '#64748b';
                emailToggle.style.borderColor = '#e2e8f0';
                emailGroup.style.display = 'none';
                phoneGroup.style.display = 'block';
                document.getElementById('login-email').required = false;
                document.getElementById('login-phone').required = true;
            }
        }

      
        function toggleRegisterType(type) {
            currentRegisterType = type;
            const emailToggle = document.getElementById('register-email-toggle');
            const phoneToggle = document.getElementById('register-phone-toggle');
            const emailGroup = document.getElementById('register-email-group');
            const phoneGroup = document.getElementById('register-phone-group');

            if (type === 'email') {
                emailToggle.style.background = '#4f46e5';
                emailToggle.style.color = 'white';
                emailToggle.style.borderColor = '#4f46e5';
                phoneToggle.style.background = 'white';
                phoneToggle.style.color = '#64748b';
                phoneToggle.style.borderColor = '#e2e8f0';
                emailGroup.style.display = 'block';
                phoneGroup.style.display = 'none';
                document.getElementById('register-email').required = true;
                document.getElementById('register-phone').required = false;
            } else {
                phoneToggle.style.background = '#4f46e5';
                phoneToggle.style.color = 'white';
                phoneToggle.style.borderColor = '#4f46e5';
                emailToggle.style.background = 'white';
                emailToggle.style.color = '#64748b';
                emailToggle.style.borderColor = '#e2e8f0';
                emailGroup.style.display = 'none';
                phoneGroup.style.display = 'block';
                document.getElementById('register-email').required = false;
                document.getElementById('register-phone').required = true;
            }
        }

       
        function backToRegister(event) {
            event.preventDefault();
            document.getElementById('verify-phone-form').style.display = 'none';
            document.getElementById('register-form').classList.add('active');
            document.getElementById('modal-message').style.display = 'none';
        }

   
        async function handleVerifyPhone(event) {
            event.preventDefault();

            const code = document.getElementById('verify-code').value;
            const btn = document.getElementById('verify-btn');

            if (!pendingPhoneVerification) {
                showModalMessage('Erro: Nenhuma verifica√ß√£o pendente', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Verificando...';

            try {
                const response = await API.post('/api/verify-phone', {
                    phone: pendingPhoneVerification.phone,
                    code: code
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    token = data.token;
                    user = data.user;
                    pendingPhoneVerification = null;
                    showModalMessage('Telefone verificado com sucesso!', 'success');
                    setTimeout(() => {
                        closeLoginModal();
                        updateUI();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 1000);
                } else {
                    showModalMessage(data.error || 'C√≥digo inv√°lido', 'error');
                }
            } catch (error) {
                showModalMessage('Erro ao verificar c√≥digo: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Verificar';
            }
        }

        
        async function resendPhoneCode(event) {
            event.preventDefault();

            if (!pendingPhoneVerification) {
                showModalMessage('Erro: Nenhuma verifica√ß√£o pendente', 'error');
                return;
            }

            try {
                const response = await API.post('/api/resend-phone-code', {
                    phone: pendingPhoneVerification.phone
                });

                const data = await response.json();

                if (data.success) {
                    showModalMessage('C√≥digo reenviado para seu WhatsApp!', 'success');
                } else {
                    showModalMessage(data.error || 'Erro ao reenviar c√≥digo', 'error');
                }
            } catch (error) {
                showModalMessage('Erro ao reenviar c√≥digo: ' + error.message, 'error');
            }
        }


        async function handleLogin(event) {
            event.preventDefault();

            const password = document.getElementById('login-password').value;
            const btn = document.getElementById('login-btn');

            let identifier;
            if (currentLoginType === 'email') {
                identifier = document.getElementById('login-email').value;
            } else {
                const phoneNumber = document.getElementById('login-phone').value;
                identifier = '+55' + phoneNumber;
            }

            btn.disabled = true;
            btn.textContent = 'Entrando...';

            try {
                const response = await API.post('/api/login', {
                    email: currentLoginType === 'email' ? identifier : undefined,
                    phone: currentLoginType === 'phone' ? identifier : undefined,
                    password
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    token = data.token;
                    user = data.user;
                    showModalMessage('Login realizado com sucesso!', 'success');
                    setTimeout(() => {
                        closeLoginModal();
                        updateUI();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 1000);
                } else {
                    showModalMessage(data.error, 'error');
                }
            } catch (error) {
                showModalMessage('Erro ao fazer login: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Entrar';
            }
        }

        async function handleForgotPassword(event) {
            event.preventDefault();

            const email = document.getElementById('forgot-email').value;
            const btn = document.getElementById('forgot-btn');
            const messageDiv = document.getElementById('forgot-message');

            btn.disabled = true;
            btn.textContent = 'Enviando...';
            messageDiv.style.display = 'none';

            try {
                const response = await API.post('/api/forgot-password', { email });

                const data = await response.json();

                if (data.success) {
                    messageDiv.textContent = 'Link de recupera√ß√£o enviado! Verifique seu email.';
                    messageDiv.className = 'message success';
                    messageDiv.style.display = 'block';
                    document.getElementById('forgot-email').value = '';
                } else {
                    messageDiv.textContent = data.error || 'Erro ao enviar link de recupera√ß√£o';
                    messageDiv.className = 'message error';
                    messageDiv.style.display = 'block';
                }
            } catch (error) {
                messageDiv.textContent = 'Erro ao processar solicita√ß√£o: ' + error.message;
                messageDiv.className = 'message error';
                messageDiv.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.textContent = 'Enviar Link de Recupera√ß√£o';
            }
        }

        async function handleRegister(event) {
            event.preventDefault();

            const password = document.getElementById('register-password').value;
            const passwordConfirm = document.getElementById('register-password-confirm').value;
            const btn = document.getElementById('register-btn');

            if (password !== passwordConfirm) {
                showModalMessage('As senhas n√£o coincidem', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Criando conta...';

            try {
                let response;
                let data;

                if (currentRegisterType === 'email') {
                  
                    const email = document.getElementById('register-email').value;
                    response = await API.post('/api/register', { email, password });
                    data = await response.json();

                    if (data.success) {
                        document.getElementById('register-form').querySelector('form').reset();
                        closeLoginModal();
                        showSuccessRegistration(email);
                        openLoginModal();
                        switchTab('login');
                        showModalMessage('Verifique seu email para ativar sua conta antes de fazer login.', 'success');
                    } else {
                        showModalMessage(data.error, 'error');
                    }
                } else {
            
                    const phoneNumber = document.getElementById('register-phone').value;
                    const phone = '+55' + phoneNumber;

                    response = await API.post('/api/register-phone', { phone, password });
                    data = await response.json();

                    if (data.success) {
                      
                        pendingPhoneVerification = { phone };
                        document.getElementById('verify-phone-display').textContent = phone;
                        document.getElementById('register-form').classList.remove('active');
                        document.getElementById('verify-phone-form').style.display = 'block';
                        document.getElementById('verify-phone-form').classList.add('active');
                        showModalMessage('C√≥digo de verifica√ß√£o enviado para seu WhatsApp!', 'success');
                    } else {
                        showModalMessage(data.error, 'error');
                    }
                }
            } catch (error) {
                showModalMessage('Erro ao criar conta: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Criar Conta';
            }
        }


        async function handleSend(event) {
            event.preventDefault();

            const phoneNumber = document.getElementById('phone').value;
            const fullPhone = '+55' + phoneNumber;
            const message = document.getElementById('message').value;
            const btn = document.getElementById('send-btn');

           
            const hasAudio = currentAudioBase64 !== null;
            const hasMessage = message && message.trim().length > 0;

            if (!hasAudio && !hasMessage) {
                showMessage('send-message', 'Por favor, digite uma mensagem ou grave/envie um √°udio.', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = hasAudio ? 'Enviando √°udio...' : 'Enviando...';

            try {
                let response;
                let data;

                if (hasAudio) {
                   
                    response = await API.post('/api/send-whatsapp-audio', {
                        phone: fullPhone,
                        audioBase64: currentAudioBase64,
                        mimetype: currentAudioMimetype,
                        caption: message || ''
                    }, token);
                } else {
                  
                    response = await API.post('/api/send-whatsapp', {
                        phone: fullPhone,
                        message: message
                    }, token);
                }

                data = await response.json();

                if (data.success) {
                    const successMsg = hasAudio ? '√Åudio enviado com sucesso! ‚úì' : 'Mensagem enviada com sucesso! ‚úì';
                    showMessage('send-message', successMsg, 'success');

                 
                    const sentPhone = phoneNumber;

                    document.getElementById('sendForm').reset();
                    removeAudio(); 
                    updateCreditsDisplay(data.whatsapp_credits, data.sms_credits);
                    loadHistory();

              
                    setTimeout(() => {
                        showSavePrompt(sentPhone);
                    }, 500);
                } else {
                    if (data.moderationReason) {
                        showMessage('send-message', '‚ö†Ô∏è Mensagem bloqueada: Sua mensagem cont√©m conte√∫do inadequado e n√£o pode ser enviada. Por favor, revise o texto e tente novamente.', 'error');
                    } else {
                        showMessage('send-message', data.error, 'error');
                    }
                }
            } catch (error) {
                console.error('[DEBUG] Erro completo:', error);
                showMessage('send-message', 'Erro: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Enviar Mensagem';
            }
        }


        function selectQuantity(qty) {
            selectedQuantity = qty;
            document.querySelectorAll('.quantity-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.closest('.quantity-option').classList.add('selected');
            document.getElementById('custom-quantity').value = qty;
            updateBonusPreview();
        }

        function updateBonusPreview() {
            const input = document.getElementById('custom-quantity');
            const preview = document.getElementById('bonus-preview');
            const qty = parseInt(input.value);

            if (qty && qty > 0) {
                const total = qty * 2;
                preview.textContent = `üéÅ Voc√™ paga R$ ${qty},00 e recebe ${total} mensagens!`;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        // ========== PAGAMENTOS MERCADO PAGO ==========
        let currentPixPaymentId = null;
        let pixPollingInterval = null;

        async function buyWithPix() {
            const quantity = parseInt(document.getElementById('custom-quantity').value) || selectedQuantity;

            if (!quantity || quantity < 1) {
                showAlert('Por favor, selecione ou digite uma quantidade', 'warning');
                return;
            }

            const btn = document.getElementById('buy-pix-btn');
            btn.disabled = true;
            btn.innerHTML = '<span style="font-size: 18px;">‚è≥</span> Gerando PIX...';

            try {
                const response = await API.post('/api/create-pix', { quantity }, token);
                const data = await response.json();

                if (data.success) {
                    showPixModal(data, quantity);
                } else {
                    showAlert(data.error || 'Erro ao gerar PIX', 'error');
                }
            } catch (error) {
                showAlert('Erro: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span style="font-size: 18px;">üì±</span> Pagar com PIX';
            }
        }

        async function buyWithCard() {
            const quantity = parseInt(document.getElementById('custom-quantity').value) || selectedQuantity;

            if (!quantity || quantity < 1) {
                showAlert('Por favor, selecione ou digite uma quantidade', 'warning');
                return;
            }

            const btn = document.getElementById('buy-card-btn');
            btn.disabled = true;
            btn.innerHTML = '<span style="font-size: 18px;">‚è≥</span> Redirecionando...';

            try {
                const response = await API.post('/api/create-card-payment', { quantity }, token);
                const data = await response.json();

                if (data.success) {
                    window.location.href = data.checkoutUrl;
                } else {
                    showAlert(data.error || 'Erro ao criar pagamento', 'error');
                    btn.disabled = false;
                    btn.innerHTML = '<span style="font-size: 18px;">üí≥</span> Cart√£o';
                }
            } catch (error) {
                showAlert('Erro: ' + error.message, 'error');
                btn.disabled = false;
                btn.innerHTML = '<span style="font-size: 18px;">üí≥</span> Cart√£o';
            }
        }

        function showPixModal(data, quantity) {
            currentPixPaymentId = data.paymentId;
            const total = quantity * 2;

            document.getElementById('pix-subtitle').textContent = `R$ ${quantity},00 = ${total} mensagens`;
            document.getElementById('pix-qr-image').src = `data:image/png;base64,${data.qrCodeBase64}`;
            document.getElementById('pix-code').textContent = data.qrCode;
            document.getElementById('pix-status').className = 'pix-status pending';
            document.getElementById('pix-status').innerHTML = '‚è≥ Aguardando pagamento...';

            document.getElementById('pix-modal').classList.add('show');

            // Iniciar polling para verificar pagamento
            startPixPolling();
        }

        function closePixModal() {
            document.getElementById('pix-modal').classList.remove('show');
            stopPixPolling();
            currentPixPaymentId = null;
        }

        function closePixModalOnBackdrop(event) {
            if (event.target.id === 'pix-modal') {
                closePixModal();
            }
        }

        function copyPixCode() {
            const pixCode = document.getElementById('pix-code').textContent;
            navigator.clipboard.writeText(pixCode).then(() => {
                showAlert('C√≥digo PIX copiado!', 'success');
            }).catch(() => {
                // Fallback para navegadores antigos
                const textarea = document.createElement('textarea');
                textarea.value = pixCode;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showAlert('C√≥digo PIX copiado!', 'success');
            });
        }

        function startPixPolling() {
            if (pixPollingInterval) return;

            pixPollingInterval = setInterval(async () => {
                if (!currentPixPaymentId) {
                    stopPixPolling();
                    return;
                }

                try {
                    const response = await API.get(`/api/verify-payment/${currentPixPaymentId}`, token);
                    const data = await response.json();

                    if (data.paid) {
                        document.getElementById('pix-status').className = 'pix-status approved';
                        document.getElementById('pix-status').innerHTML = '‚úÖ Pagamento confirmado!';
                        stopPixPolling();

                        // Atualizar creditos e fechar modal
                        setTimeout(() => {
                            closePixModal();
                            loadUserData();
                            loadPaymentHistory();
                            showAlert('Pagamento confirmado! Seus cr√©ditos foram adicionados.', 'success');
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Erro ao verificar pagamento:', error);
                }
            }, 5000); // Verificar a cada 5 segundos
        }

        function stopPixPolling() {
            if (pixPollingInterval) {
                clearInterval(pixPollingInterval);
                pixPollingInterval = null;
            }
        }
        // ========== FIM PAGAMENTOS ==========


        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            token = null;
            user = null;
            disconnectSocket(); 
            stopRepliesPolling();
            updateUI();
        }

        function connectSocket() {
            if (socket) return; 

            socket = io(API_CONFIG.baseURL, {
                transports: ['websocket', 'polling']
            });

            socket.on('connect', () => {
                if (user && user.id) {
                    socket.emit('authenticate', user.id);
                }
            });

            socket.on('disconnect', () => {});

            socket.on('new-reply', (reply) => {
                loadReplies();
  
                loadHistory();
                showNewReplyNotification(reply);
            });
        }

        function disconnectSocket() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }

        function showNewReplyNotification(reply) {
            const hasAudio = reply.audio_url && reply.audio_url.length > 0;
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(79, 70, 229, 0.4);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                max-width: 350px;
            `;
            const icon = hasAudio ? 'üé§' : 'üì±';
            const title = hasAudio ? 'Nova Resposta de √Åudio!' : 'Nova Resposta!';
            notification.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 5px;">${icon} ${title}</div>
                <div style="font-size: 14px; opacity: 0.95;">${reply.message.substring(0, 100)}${reply.message.length > 100 ? '...' : ''}</div>
            `;

 
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);


            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }


        function startRepliesPolling() {
            if (repliesPollingInterval) return; 


            repliesPollingInterval = setInterval(() => {
                if (token) {
                    loadReplies();
                    loadHistory();
                }
            }, 60000);
        }

        function stopRepliesPolling() {
            if (repliesPollingInterval) {
                clearInterval(repliesPollingInterval);
                repliesPollingInterval = null;
            }
        }


        function showMessage(elementId, text, type) {
            const message = document.getElementById(elementId);
            message.innerHTML = text;
            message.className = `message ${type}`;
            message.style.display = 'block';

            if (type === 'success') {
                setTimeout(() => {
                    message.style.display = 'none';
                }, 5000);
            }
        }

        function showModalMessage(text, type) {
            const message = document.getElementById('modal-message');
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
        }

        window.onclick = function(event) {
            const forgotModal = document.getElementById('forgotPasswordModal');

            if (event.target == forgotModal) {
                closeForgotPasswordModal();
            }
        }

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('payment') === 'success' && token) {
            setTimeout(() => {
                loadUserData();
                loadPaymentHistory();
                showMessage('buy-message', 'Mensagens adicionadas com sucesso!', 'success');
            }, 1000);
        }

        updateUI();
    </script>

    <!-- Footer -->
    <footer style="max-width: 700px; margin: 40px auto 20px; text-align: center; padding: 20px; color: #64748b; font-size: 14px;">
        <div style="margin-bottom: 15px;">
            <a href="/fale-conosco" style="color: #4f46e5; text-decoration: none; margin: 0 15px;">Fale Conosco</a>
            <a href="/privacy" style="color: #4f46e5; text-decoration: none; margin: 0 15px;">Politica de Privacidade</a>
            <a href="/terms" style="color: #4f46e5; text-decoration: none; margin: 0 15px;">Termos de Uso</a>
        </div>
        <p style="margin: 0; color: #94a3b8; font-size: 12px;">
            &copy; 2025 Zap An√¥nimo. Todos os direitos reservados.
        </p>
    </footer>

    <!-- Modal Favoritos -->
    <div id="favorites-modal" class="favorites-modal" onclick="closeFavoritesModalOnBackdrop(event)">
        <div class="favorites-modal-content">
            <div class="favorites-modal-header">
                <h3>‚≠ê Meus Favoritos</h3>
                <button class="favorites-modal-close" onclick="closeFavoritesModal()">&times;</button>
            </div>
            <div class="favorites-modal-body">
                <div id="favorites-list" class="favorites-list">
                    <!-- Lista de favoritos sera preenchida via JS -->
                </div>
                <div class="favorites-add-form">
                    <h4>Adicionar novo favorito</h4>
                    <input type="text" id="new-favorite-name" placeholder="Nome (ex: Joao)">
                    <input type="tel" id="new-favorite-phone" placeholder="Telefone (ex: 11999999999)" maxlength="11">
                    <button type="button" onclick="addFavorite()">Adicionar Favorito</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt para salvar favorito -->
    <div id="save-favorite-prompt" class="save-favorite-prompt">
        <p>Deseja salvar este numero nos favoritos?</p>
        <input type="text" id="save-favorite-name" placeholder="Nome do contato" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 12px; font-size: 14px;">
        <div class="save-favorite-prompt-buttons">
            <button class="btn-skip" onclick="closeSavePrompt()">Nao</button>
            <button class="btn-save" onclick="saveFavoriteFromPrompt()">Salvar</button>
        </div>
    </div>

    <!-- Modal de Confirmacao/Alerta Personalizado -->
    <div id="custom-modal" class="custom-modal-overlay" onclick="closeCustomModalOnBackdrop(event)">
        <div class="custom-modal-box">
            <div class="custom-modal-icon" id="custom-modal-icon"></div>
            <div class="custom-modal-title" id="custom-modal-title"></div>
            <div class="custom-modal-message" id="custom-modal-message"></div>
            <div class="custom-modal-buttons" id="custom-modal-buttons"></div>
        </div>
    </div>

    <!-- Modal PIX -->
    <div id="pix-modal" class="pix-modal" onclick="closePixModalOnBackdrop(event)">
        <div class="pix-modal-content">
            <div class="pix-modal-title">üì± Pagamento PIX</div>
            <div class="pix-modal-subtitle" id="pix-subtitle">Escaneie o QR Code ou copie o c√≥digo</div>

            <div id="pix-status" class="pix-status pending">
                ‚è≥ Aguardando pagamento...
            </div>

            <div class="pix-qr-container">
                <img id="pix-qr-image" src="" alt="QR Code PIX">
            </div>

            <div class="pix-code-container" id="pix-code"></div>

            <button class="pix-copy-btn" onclick="copyPixCode()">
                üìã Copiar c√≥digo PIX
            </button>

            <button class="pix-close-btn" onclick="closePixModal()">Fechar</button>
        </div>
    </div>

</body>
</html>
